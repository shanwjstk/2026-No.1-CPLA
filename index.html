<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>í˜„ì¶œì—°ìŠµ ì›¹ì•± â€“ Toss-like Clean UI</title>
<style>
  :root{
    /* ===== Toss-like ë¼ì´íŠ¸ íŒ”ë ˆíŠ¸ ===== */
    --bg:#ffffff;
    --panel:#ffffff;
    --line:#e5e7eb;
    --shadow:0 10px 28px rgba(2,6,23,.06);

    --text:#0f172a;         /* ë³¸ë¬¸ */
    --muted:#64748b;        /* ë³´ì¡° í…ìŠ¤íŠ¸ */

    --brand:#0064ff;        /* í¬ì¸íŠ¸ ë¸”ë£¨ (í† ìŠ¤ ëŠë‚Œ) */
    --brand-strong:#004fe0; /* hover/ê°•ì¡° */

    --good:#12b886;         /* ë³´ì¡° ì„±ê³µ */
    --bad:#ef4444;
    --warn:#f59e0b;

    --chip-bg:#f8fafc;
    --chip-line:#e5e7eb;

    --hint-bg:#f8fafc;
    --meter-bg:#eef4ff;
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--text);
    font-family:Pretendard, Apple SD Gothic Neo, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  }

  /* ===== ìƒë‹¨ í—¤ë” (ì–‡ê³  ê¹”ë”) ===== */
  .topbar{
    position:sticky; top:0; z-index:10; backdrop-filter:saturate(180%) blur(8px);
    background:rgba(255,255,255,.86); border-bottom:1px solid var(--line);
  }
  .topbar-inner{max-width:1200px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;padding:14px 20px}
  .brand{display:flex;align-items:center;gap:10px;font-weight:800;letter-spacing:-.2px}
  .brand-dot{width:10px;height:10px;border-radius:50%;background:var(--brand)}
  .brand-title{font-size:18px;color:var(--brand-strong)}
  .top-actions{display:flex;gap:8px}

  .wrap{max-width:1200px;margin:28px auto;padding:20px}
  h1{font-size:28px;margin:12px 0 6px;font-weight:800;letter-spacing:-.3px}
  .sub{color:var(--muted);font-size:14px;margin-bottom:22px}

  .grid{display:grid;grid-template-columns:380px 1fr;gap:20px}
  .card{
    background:var(--panel);border:1px solid var(--line);
    border-radius:16px; box-shadow:var(--shadow); overflow:hidden;
  }
  .hd{
    display:flex; align-items:center; justify-content:space-between; gap:12px;
    padding:16px 18px; border-bottom:1px solid var(--line); background:#fbfbfd;
  }
  .hd strong{font-weight:800; letter-spacing:-.2px}
  .bd{padding:16px 18px}

  /* ===== í¼ & íƒ€ì´í¬ ===== */
  input,textarea,select{
    width:100%; border:1px solid var(--line); border-radius:12px; padding:12px 14px; font-size:14px;
    background:#fff; color:var(--text); outline:none; transition:border-color .2s, box-shadow .2s, transform .06s;
  }
  input:focus,textarea:focus,select:focus{
    border-color:#c7d2fe; box-shadow:0 0 0 4px rgba(0,100,255,.18);
  }
  textarea{min-height:96px; resize:vertical}
  .note{color:var(--muted); font-size:13px}
  .muted{color:var(--muted)}

  .row{display:flex; gap:12px; align-items:center}
  .row>*{flex:1}
  .sep{height:1px; background:var(--line); margin:16px 0}

  .list{max-height:460px; overflow:auto; padding-right:6px}
  .item{
    display:flex; align-items:center; gap:10px;
    padding:12px; margin:10px 0; background:#fff; border:1px solid var(--line); border-radius:14px;
  }
  .tag{display:inline-block; border:1px solid var(--chip-line); background:var(--chip-bg); color:var(--text);
    border-radius:999px; padding:6px 10px; margin:4px 6px 0 0; font-size:12px}

  .hint{
    background:var(--hint-bg); border:1px dashed var(--line); border-radius:12px; padding:12px; margin-top:8px
  }

  .meter{height:14px; background:var(--meter-bg); border:1px solid var(--line); border-radius:999px; overflow:hidden}
  .fill{height:100%; background:linear-gradient(90deg,#60a5fa,#0064ff); width:0%}

  /* ===== ë²„íŠ¼: í† ìŠ¤ ëŠë‚Œ (ì„ ëª…í•œ ë¸”ë£¨, ë‘¥ê¸€ê³  ë¯¸ì„¸ ê·¸ë¼ë°ì´ì…˜) ===== */
  .btn{
    --btn-bg:#fff; --btn-fg:var(--text); --btn-border:var(--line);
    position:relative; display:inline-flex; align-items:center; justify-content:center; gap:8px;
    padding:12px 16px; border-radius:12px; border:1px solid var(--btn-border); background:var(--btn-bg); color:var(--btn-fg);
    font-weight:800; letter-spacing:-.2px; font-size:14px; cursor:pointer; user-select:none;
    transition:transform .08s ease, box-shadow .2s ease, background .2s ease, border-color .2s ease, filter .2s ease;
    box-shadow:0 1px 0 rgba(2,6,23,.03), 0 8px 16px rgba(2,6,23,.04);
  }
  .btn:hover{transform:translateY(-1px); box-shadow:0 8px 18px rgba(2,6,23,.08)}
  .btn:active{transform:translateY(0); box-shadow:0 4px 12px rgba(2,6,23,.06)}
  .btn:focus-visible{outline:none; box-shadow:0 0 0 4px rgba(0,100,255,.22)}
  .btn-ghost{--btn-bg:#fff; --btn-border:var(--line)}
  .btn-ghost:hover{background:#f8fafc}

  .btn-primary{
    --btn-bg:linear-gradient(180deg,#3b82f6,#0064ff);
    --btn-fg:#fff; --btn-border:#0057e6;
    box-shadow:0 8px 18px rgba(0,100,255,.22);
  }
  .btn-primary::after{
    content:""; position:absolute; inset:0; border-radius:12px; pointer-events:none;
    background:linear-gradient(180deg,rgba(255,255,255,.35),rgba(255,255,255,0)); mix-blend-mode:soft-light; opacity:.75;
  }
  .btn-danger{
    --btn-bg:linear-gradient(180deg,#f87171,#ef4444);
    --btn-fg:#fff; --btn-border:#dc2626;
    box-shadow:0 8px 18px rgba(239,68,68,.18);
  }

  .btn-chip{
    --btn-bg:#fff; --btn-border:var(--chip-line);
    padding:8px 12px; border-radius:999px; font-size:12px; font-weight:800;
  }

  /* ===== ìƒíƒœ ë°•ìŠ¤ (ì •ì˜¤ë‹µ ê°•ì¡°) ===== */
  .status{margin-top:10px; border-radius:14px; padding:12px; border:1px solid; display:flex; align-items:center; gap:10px; font-weight:800}
  .ok{background:#eff8ff; border-color:#bfdbfe; color:#0b3ea8}     /* ë¸”ë£¨ ê¸°ë°˜ì˜ 'ì •ë‹µ' */
  .ng{background:#fef2f2; border-color:#fecaca; color:#7f1d1d}
  .warn{background:#fff7ed; border-color:#fed7aa; color:#7c2d12}

  /* ì‘ì€ ë±ƒì§€ */
  .badge{
    display:inline-flex; align-items:center; gap:6px; border:1px solid var(--chip-line);
    background:var(--chip-bg); border-radius:999px; padding:6px 10px; font-size:12px; font-weight:700;
  }
  .mini{font-size:12px}
</style>
</head>
<body>

  <!-- ìƒë‹¨ ë°” -->
  <header class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div class="brand-dot"></div>
        <div class="brand-title">í˜„ì¶œì—°ìŠµ</div>
      </div>
      <div class="top-actions">
        <button class="btn btn-ghost" id="exportBtn">ë‚´ë³´ë‚´ê¸°</button>
        <label class="btn btn-ghost" for="importFile">ê°€ì ¸ì˜¤ê¸°</label>
        <input id="importFile" type="file" accept="application/json" style="display:none" />
      </div>
    </div>
  </header>

  <main class="wrap">
    <h1>í‚¤ì›Œë“œ ê¸°ë°˜ ì„œìˆ í˜• ëŒ€ë¹„</h1>
    <div class="sub">í† ìŠ¤ ëŠë‚Œì˜ <b style="color:var(--brand)">ê¹¨ë—í•˜ê³  ì„ ëª…í•œ UI</b>ë¡œ, ê¸°ì–µ-í˜„ì¶œ í›ˆë ¨ì„ ë¹ ë¥´ê²Œ.</div>

    <div class="grid">
      <!-- ì™¼ìª½: ì„¸íŠ¸ ê´€ë¦¬ -->
      <section class="card">
        <div class="hd">
          <strong>ì„¸íŠ¸ ë§Œë“¤ê¸°</strong>
          <span class="badge">ìë™ ì €ì¥(LocalStorage)</span>
        </div>
        <div class="bd">
          <div class="note">í‚¤ì›Œë“œëŠ” ì‰¼í‘œ(, )ë¡œ êµ¬ë¶„. ì˜ˆ: ê³µì •ë ¥, ì²˜ë¶„ì„±, ì œì†Œê¸°ê°„</div>
          <div style="height:8px"></div>
          <input id="title" type="text" placeholder="ì œëª© (ì˜ˆ: í–‰ì •í–‰ìœ„ì˜ ê³µì •ë ¥ê³¼ ì·¨ì†Œì†Œì†¡)" />
          <div style="height:8px"></div>
          <textarea id="keywords" placeholder="ì£¼ìš” í‚¤ì›Œë“œ (ì‰¼í‘œë¡œ êµ¬ë¶„)"></textarea>
          <div style="height:8px"></div>
          <textarea id="refAnswer" placeholder="ì°¸ê³  ë‹µì•ˆ (ì„ íƒ)"></textarea>

          <div style="height:12px"></div>
          <div class="row">
            <button class="btn btn-primary" id="saveBtn">ì¶”ê°€/ì €ì¥</button>
            <button class="btn btn-danger" id="clearFormBtn">ì…ë ¥ ì§€ìš°ê¸°</button>
          </div>

          <div class="sep"></div>
          <div class="row" style="align-items:center">
            <strong>ì„¸íŠ¸ ëª©ë¡</strong>
            <span id="statsSummary" class="note" style="text-align:right"></span>
          </div>
          <div id="list" class="list"></div>
        </div>
      </section>

      <!-- ì˜¤ë¥¸ìª½: ì—°ìŠµ í™”ë©´ -->
      <section class="card">
        <div class="hd">
          <strong>í˜„ì¶œ ì—°ìŠµ</strong>
          <div class="row" style="flex:0 0 auto">
            <label class="btn btn-chip" style="gap:8px"><input type="checkbox" id="weakOnly"> ë°˜ë³µí•™ìŠµ(â‰¤60%)</label>
            <label class="btn btn-chip" style="gap:8px"><input type="checkbox" id="hintToggle" checked> íŒíŠ¸ í‘œì‹œ</label>
          </div>
        </div>
        <div class="bd">
          <div class="row">
            <select id="deckSelect"></select>
            <button class="btn btn-chip" id="prevBtn">ì´ì „</button>
            <button class="btn btn-chip" id="nextBtn">ë‹¤ìŒ</button>
          </div>

          <div class="hint">
            <b id="qTitle">ì—°ìŠµí•  í•­ëª©ì„ ì„ íƒí•˜ì„¸ìš”.</b>
            <span class="note mini" id="qInfo"></span>
          </div>
          <div id="hintBox" class="hint mini" style="display:none"></div>

          <div style="height:8px"></div>
          <textarea id="answer" placeholder="ê¸°ì–µë‚˜ëŠ” í‚¤ì›Œë“œ ì¤‘ì‹¬ìœ¼ë¡œ ê°„ë‹¨íˆ â†’ ë¬¸ì¥í™”. (Ctrl/âŒ˜+Enterë¡œ ì±„ì )"></textarea>

          <div style="height:10px"></div>
          <div class="row" style="align-items:center">
            <button class="btn btn-primary" id="gradeBtn">ì±„ì </button>
            <button class="btn btn-ghost" id="showRefBtn" style="flex:0 0 auto">ì°¸ê³  ë‹µì•ˆ</button>
            <span id="streakBadge" class="badge" style="flex:0 0 auto">ì •ë‹µë¥  â€”</span>
          </div>

          <div style="height:12px"></div>
          <div class="meter"><div id="meterFill" class="fill"></div></div>

          <div id="statusBox" class="status warn" style="display:none">
            <span id="statusIcon">âš ï¸</span><span id="statusText">ì±„ì  ëŒ€ê¸° ì¤‘â€¦</span>
          </div>

          <div id="miss" class="note mini" style="margin-top:6px"></div>

          <div id="refWrap" style="display:none;margin-top:10px">
            <div class="note mini">ì°¸ê³  ë‹µì•ˆ(ì „ì²´)</div>
            <pre id="refOut" class="note mini" style="white-space:pre-wrap"></pre>
          </div>
        </div>
      </section>
    </div>
  </main>

<script>
/* ========= ë°ì´í„°/ìƒíƒœ ========= */
var KEY='recallDecks.v1';
var STATS='recallStats.v1'; // { [id]: {attempts, lastScore(0~1)} }

var decks=[];          // [{id,title,keywords[],ref?}]
var statsMap={};       // ì§„í–‰ í†µê³„
var idx=-1;            // í˜„ì¬ ì¸ë±ìŠ¤
var pool=[];           // ë°˜ë³µí•™ìŠµ(<=60%) ì¸ë±ìŠ¤ ë¬¶ìŒ
var weakMode=false;

/* ========= ìœ í‹¸ ========= */
function uid(){return Math.random().toString(36).slice(2,9)}
function z(n){n=String(n);return ('0'+n).slice(-2)}
function escapeHtml(s){return String(s).replace(/[&<>"']/g,function(c){return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c];})}
function parseKeywords(t){return String(t).split(',').map(function(s){return s.trim();}).filter(function(x){return !!x;});}

/* ========= ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° ========= */
function load(){
  try{decks=JSON.parse(localStorage.getItem(KEY)||'[]')}catch(e){decks=[]}
  try{statsMap=JSON.parse(localStorage.getItem(STATS)||'{}')}catch(e){statsMap={}}
}
function save(){ try{localStorage.setItem(KEY, JSON.stringify(decks));}catch(e){} }
function saveStats(){ try{localStorage.setItem(STATS, JSON.stringify(statsMap));}catch(e){} }

/* ========= ë Œë” ========= */
function renderSelect(){
  var sel=document.getElementById('deckSelect');
  sel.innerHTML = decks.map(function(d,i){return '<option value="'+i+'">'+(i+1)+'. '+escapeHtml(d.title)+'</option>'}).join('');
}
function renderList(){
  var list=document.getElementById('list'); list.innerHTML='';
  if(!decks.length){ list.innerHTML='<div class="note">ì•„ì§ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤. ìœ„ì—ì„œ ì¶”ê°€í•˜ì„¸ìš”.</div>'; renderSelect(); renderSummary(); return; }
  for(var i=0;i<decks.length;i++){
    var d=decks[i], st=statsMap[d.id]||{attempts:0,lastScore:0};
    var rate = st.attempts? Math.round(st.lastScore*100)+'%' : 'â€”';
    var div=document.createElement('div'); div.className='item';
    div.innerHTML =
      '<div style="flex:1">'+
      '<div style="font-weight:800">'+escapeHtml(d.title)+'</div>'+
      '<div class="mini muted">ìµœê·¼ ì •ë‹µë¥ : '+rate+' Â· ì‹œë„: '+st.attempts+'íšŒ</div>'+
      '<div style="margin-top:2px">'+d.keywords.map(function(k){return '<span class="tag">'+escapeHtml(k)+'</span>'}).join('')+'</div>'+
      '</div>'+
      '<button class="btn btn-ghost" data-act="edit" data-i="'+i+'">ìˆ˜ì •</button>'+
      '<button class="btn btn-danger" data-act="del" data-i="'+i+'">ì‚­ì œ</button>';
    list.appendChild(div);
  }
  renderSelect(); renderSummary();
}
function renderSummary(){
  var weak=0,tried=0,i,st;
  for(i=0;i<decks.length;i++){
    st=statsMap[decks[i].id];
    if(st && st.attempts>0){ tried++; if(st.lastScore<=0.6) weak++; }
  }
  var sum='ì „ì²´ '+decks.length+'ê°œ'; if(tried>0) sum+=' Â· 60% ì´í•˜ '+weak+'ê°œ';
  document.getElementById('statsSummary').textContent=sum;
}

/* ========= ë°˜ë³µí•™ìŠµ í’€ ========= */
function buildPool(){
  pool=[];
  if(!weakMode){ for(var i=0;i<decks.length;i++) pool.push(i); }
  else{
    for(var j=0;j<decks.length;j++){
      var st=statsMap[decks[j].id];
      if(st && st.attempts>0 && st.lastScore<=0.6) pool.push(j);
    }
    if(pool.length===0){
      var sb=document.getElementById('statusBox');
      sb.style.display='flex'; sb.className='status ok';
      document.getElementById('statusIcon').textContent='ğŸ’«';
      document.getElementById('statusText').textContent='ë°˜ë³µí•™ìŠµ ëŒ€ìƒ(â‰¤60%)ì´ ì—†ìŠµë‹ˆë‹¤. ì „ì²´ ëª¨ë“œë¡œ ì§„í–‰í•´ ë³´ì„¸ìš”.';
    }
  }
}

/* ========= í™”ë©´ ì „í™˜ ========= */
function showByIndex(i){
  if(!decks.length) return;
  idx=(i+decks.length)%decks.length;
  document.getElementById('deckSelect').value=String(idx);
  var d=decks[idx];
  document.getElementById('qTitle').textContent=d.title;
  document.getElementById('qInfo').textContent='Â· í‚¤ì›Œë“œ '+d.keywords.length+'ê°œ';
  document.getElementById('answer').value='';
  document.getElementById('meterFill').style.width='0%';
  document.getElementById('statusBox').style.display='none';
  document.getElementById('miss').innerHTML='';
  // íŒíŠ¸
  var tox=document.getElementById('hintToggle').checked;
  var hb=document.getElementById('hintBox');
  if(tox && d.ref){ var t=String(d.ref); hb.style.display='block'; hb.textContent = t.length>180? t.slice(0,180)+'â€¦':t; }
  else{ hb.style.display='none'; hb.textContent=''; }
  // ë°°ì§€
  var st=statsMap[d.id];
  document.getElementById('streakBadge').textContent = (st && st.attempts>0) ? ('ìµœê·¼ ì •ë‹µë¥  '+Math.round(st.lastScore*100)+'% Â· ì‹œë„ '+st.attempts+'íšŒ') : 'ì •ë‹µë¥  â€”';
  // ì°¸ê³ ë‹µì•ˆ ë‹«ê¸°
  document.getElementById('refWrap').style.display='none';
  document.getElementById('refOut').textContent='';
}
function showNext(step){
  if(!decks.length) return;
  if(!weakMode || !pool.length){ showByIndex(idx+step); return; }
  var pIndex=pool.indexOf(idx); if(pIndex<0) pIndex=0;
  var nextIndex=(pIndex+(step>=0?1:-1)+pool.length)%pool.length;
  showByIndex(pool[nextIndex]);
}

/* ========= ì±„ì  ========= */
function grade(){
  if(idx<0) return;
  var d=decks[idx];
  var txt=String(document.getElementById('answer').value||'').toLowerCase();
  var hits=[], missed=[];
  for(var i=0;i<d.keywords.length;i++){
    var w=String(d.keywords[i]||'').toLowerCase();
    if(txt.indexOf(w)>-1) hits.push(d.keywords[i]); else missed.push(d.keywords[i]);
  }
  var ratio=d.keywords.length? (hits.length/d.keywords.length) : 0;

  document.getElementById('meterFill').style.width=Math.round(ratio*100)+'%';

  var box=document.getElementById('statusBox'), icon=document.getElementById('statusIcon'), text=document.getElementById('statusText');
  if(ratio>=0.7){ box.className='status ok'; icon.textContent='âœ…'; text.textContent='ì •ë‹µ â€” '+Math.round(ratio*100)+'% ('+hits.length+'/'+d.keywords.length+')'; }
  else if(ratio>0){ box.className='status warn'; icon.textContent='ğŸŸ¡'; text.textContent='ë¶€ë¶„ì •ë‹µ â€” '+Math.round(ratio*100)+'% ('+hits.length+'/'+d.keywords.length+')'; }
  else{ box.className='status ng'; icon.textContent='âŒ'; text.textContent='ì˜¤ë‹µ â€” 0%'; }
  box.style.display='flex';

  document.getElementById('miss').innerHTML = missed.length ? ('ëˆ„ë½: '+missed.map(escapeHtml).join(', ')) : '<span class="muted">ëˆ„ë½ ì—†ìŒ</span>';

  // í†µê³„ ê°±ì‹ 
  var st=statsMap[d.id]||{attempts:0,lastScore:0};
  st.attempts+=1; st.lastScore=ratio; statsMap[d.id]=st; saveStats(); renderSummary();
  if(weakMode){ buildPool(); }
  if(ratio<=0.6){ setTimeout(function(){ showNext(+1); }, 700); }
}

/* ========= ì´ˆê¸°í™” & ì´ë²¤íŠ¸ ========= */
document.addEventListener('DOMContentLoaded',function(){
  load(); renderList(); buildPool();
  if(decks.length) showByIndex(0);

  // ì„¸íŠ¸ ì €ì¥/ì‚­ì œ/ìˆ˜ì •
  document.getElementById('saveBtn').onclick=function(){
    var t=document.getElementById('title').value.trim();
    var ks=parseKeywords(document.getElementById('keywords').value);
    var r=document.getElementById('refAnswer').value.trim();
    if(!t || !ks.length){ alert('ì œëª©ê³¼ ìµœì†Œ 1ê°œì˜ í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.'); return; }
    // ì œëª© ì¤‘ë³µ ì‹œ ê°±ì‹ 
    var fi=-1; for(var i=0;i<decks.length;i++){ if(decks[i].title===t){fi=i;break;} }
    if(fi>-1){ decks[fi].keywords=ks; decks[fi].ref=r||undefined; }
    else{ decks.push({id:uid(), title:t, keywords:ks, ref:r||undefined}); }
    save(); renderList(); buildPool();
    document.getElementById('title').value=''; document.getElementById('keywords').value=''; document.getElementById('refAnswer').value='';
    if(decks.length===1) showByIndex(0);
  };
  document.getElementById('clearFormBtn').onclick=function(){
    document.getElementById('title').value=''; document.getElementById('keywords').value=''; document.getElementById('refAnswer').value='';
  };
  document.getElementById('list').onclick=function(e){
    var t=e.target; while(t && t.tagName!=='BUTTON'){ t=t.parentNode; } if(!t) return;
    var i=+t.getAttribute('data-i'); var act=t.getAttribute('data-act');
    if(act==='del'){
      if(confirm('ì‚­ì œí• ê¹Œìš”?')){
        var del=decks.splice(i,1)[0];
        if(del && statsMap[del.id]) delete statsMap[del.id];
        save(); saveStats(); renderList(); buildPool(); if(decks.length) showByIndex(0);
      }
    }else if(act==='edit'){
      var d=decks[i]; if(!d) return;
      document.getElementById('title').value=d.title;
      document.getElementById('keywords').value=d.keywords.join(', ');
      document.getElementById('refAnswer').value=d.ref||'';
    }
  };

  // ë„¤ë¹„
  document.getElementById('deckSelect').onchange=function(e){ showByIndex(+e.target.value); };
  document.getElementById('prevBtn').onclick=function(){ showNext(-1); };
  document.getElementById('nextBtn').onclick=function(){ showNext(+1); };

  // ì±„ì  & íŒíŠ¸ & ë°˜ë³µí•™ìŠµ
  document.getElementById('gradeBtn').onclick=grade;
  document.getElementById('showRefBtn').onclick=function(){
    if(idx<0) return; var d=decks[idx]; if(!d.ref){ alert('ì°¸ê³  ë‹µì•ˆì´ ì—†ìŠµë‹ˆë‹¤.'); return; }
    document.getElementById('refWrap').style.display='block';
    document.getElementById('refOut').textContent=d.ref;
  };
  document.getElementById('hintToggle').onchange=function(){
    if(idx<0) return; var d=decks[idx]; var hb=document.getElementById('hintBox');
    if(this.checked && d && d.ref){ var t=String(d.ref); hb.style.display='block'; hb.textContent=t.length>180?t.slice(0,180)+'â€¦':t; }
    else{ hb.style.display='none'; hb.textContent=''; }
  };
  document.getElementById('weakOnly').onchange=function(){ weakMode=this.checked; buildPool(); if(weakMode && pool.length) showByIndex(pool[0]); };

  // ë‚´ë³´ë‚´ê¸°/ê°€ì ¸ì˜¤ê¸°
  document.getElementById('exportBtn').onclick=function(){
    var name='recall-decks-'+(new Date().getTime())+'.json';
    var blob=new Blob([JSON.stringify(decks,null,2)],{type:'application/json'});
    var url=URL.createObjectURL(blob); var a=document.createElement('a'); a.href=url; a.download=name; a.click();
    setTimeout(function(){URL.revokeObjectURL(url);},1200);
  };
  document.getElementById('importFile').onchange=function(e){
    var f=e.target.files && e.target.files[0]; if(!f) return;
    var rd=new FileReader();
    rd.onload=function(){
      try{
        var data=JSON.parse(String(rd.result));
        if(Object.prototype.toString.call(data)!=='[object Array]') throw new Error('í˜•ì‹ ì˜¤ë¥˜');
        // ì™„ì „ êµì²´(ì‹¬í”Œ) â€” í•„ìš” ì‹œ ë³‘í•© ë¡œì§ìœ¼ë¡œ ëŒ€ì²´ ê°€ëŠ¥
        decks=data.map(function(x){return {id:(x.id||uid()), title:String(x.title||''), keywords:(x.keywords||[]).map(String), ref:(x.ref?String(x.ref):undefined)};});
        statsMap={}; save(); saveStats(); renderList(); buildPool(); if(decks.length) showByIndex(0);
      }catch(err){ alert('ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨: '+err.message); }
    };
    rd.readAsText(f,'utf-8'); e.target.value='';
  };

  // ë‹¨ì¶•í‚¤
  window.addEventListener('keydown', function(ev){
    var enter=(ev.key==='Enter'||ev.keyCode===13);
    if((ev.ctrlKey||ev.metaKey) && enter){ grade(); ev.preventDefault(); }
  });
});
</script>
</body>
</html>
