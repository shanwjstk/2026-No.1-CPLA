<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>현출연습 웹앱 – 키워드 기반 서술형 대비</title>
  <style>
    :root{--bg:#0b1020;--panel:#111833;--sub:#0f1530;--text:#eef2ff;--muted:#a6b2d9;--accent:#8bffd1}
    *{box-sizing:border-box}body{margin:0;background:linear-gradient(180deg,#0b1020,#0b0f24 40%,#0a0e1a);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Pretendard,Apple SD Gothic Neo,Malgun Gothic,sans-serif}
    .wrap{max-width:1100px;margin:28px auto;padding:16px}
    h1{font-size:22px;margin:8px 0 12px}
    .grid{display:grid;grid-template-columns:340px 1fr;gap:16px}
    .card{background:linear-gradient(180deg,#0e1633,#0d142c);border:1px solid #2a335d;border-radius:16px;box-shadow:0 10px 24px rgba(0,0,0,.35)}
    .card .hd{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid #232a52}
    .card .bd{padding:14px 16px}
    input[type=text],textarea{width:100%;background:#0c1330;border:1px solid #263069;border-radius:12px;color:var(--text);padding:12px;font-size:14px;outline:none}
    textarea{min-height:96px;resize:vertical}
    .row{display:flex;gap:10px}.row>*{flex:1}
    .btn{border:none;border-radius:12px;padding:10px 12px;font-weight:600;font-size:14px;cursor:pointer}
    .btn-primary{background:linear-gradient(180deg,#3b82f6,#2563eb);color:#fff;border:1px solid #1f49aa}
    .btn-ghost{background:#0b122e;border:1px solid #293163;color:#dfe7ff}
    .btn-danger{background:linear-gradient(180deg,#ef4444,#dc2626);color:#fff;border:1px solid #a61c1c}
    .list{max-height:360px;overflow:auto;padding-right:6px}
    .item{padding:10px;border:1px solid #24305f;background:#0b122e;border-radius:12px;margin:8px 0;display:flex;align-items:center;gap:8px}
    .tag{display:inline-block;border:1px solid #2b3564;background:#0b122e;color:#e7ecff;border-radius:999px;padding:4px 8px;margin:4px 6px 0 0;font-size:12px}
    .meter{height:12px;background:#0a0f26;border:1px solid #2a335d;border-radius:999px;overflow:hidden}
    .fill{height:100%;background:linear-gradient(90deg,#22c55e,#84cc16);width:0%}
    .small{font-size:12px;color:#c6cff9}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>현출연습 웹앱 <span class="small">– 제목 & 주요 키워드 기반 서술형 대비</span></h1>
    <div class="grid">
      <!-- 왼쪽: 세트 관리 -->
      <section class="card">
        <div class="hd">
          <strong>세트 만들기/관리</strong>
          <div>
            <button class="btn btn-ghost" id="exportBtn">내보내기</button>
            <label class="btn btn-ghost" for="importFile">가져오기</label>
            <input id="importFile" type="file" accept="application/json" style="display:none" />
            <label class="small"><input type="checkbox" id="mergeImport" checked> 병합 가져오기</label>
          </div>
        </div>
        <div class="bd">
          <input id="title" type="text" placeholder="제목 입력 (예: 행정행위의 공정력)" />
          <div style="height:8px"></div>
          <textarea id="keywords" placeholder="주요 키워드 입력 (쉼표로 구분)"></textarea>
          <div style="height:8px"></div>
          <textarea id="refAnswer" placeholder="참고 답안 (선택)"></textarea>
          <div style="height:10px"></div>
          <div class="row">
            <button class="btn btn-primary" id="saveBtn">추가/저장</button>
            <button class="btn btn-danger" id="clearFormBtn">입력 지우기</button>
          </div>
          <div style="height:10px"></div>
          <div class="list" id="list"></div>
        </div>
      </section>

      <!-- 오른쪽: 연습 영역 -->
      <section class="card">
        <div class="hd"><strong>현출 연습</strong></div>
        <div class="bd">
          <div class="row">
            <select id="deckSelect"></select>
            <button class="btn btn-ghost" id="shuffleBtn">무작위</button>
            <button class="btn btn-ghost" id="prevBtn">이전</button>
            <button class="btn btn-ghost" id="nextBtn">다음</button>
          </div>
          <div style="height:10px"></div>
          <div><b id="qTitle">연습할 항목을 선택하세요.</b></div>
          <div class="small" id="qInfo"></div>
          <div style="height:10px"></div>
          <textarea id="answer" placeholder="기억나는 키워드 중심으로 서술해 보세요."></textarea>
          <div style="height:10px"></div>
          <button class="btn btn-primary" id="gradeBtn">채점</button>
          <div style="height:10px"></div>
          <div class="meter"><div class="fill" id="meterFill"></div></div>
          <div id="result" class="small" style="margin-top:8px"></div>
          <div id="miss" class="small" style="margin-top:6px"></div>
        </div>
      </section>
    </div>
  </div>

  <script>
    const KEY = 'recallDecks.v1';
    let decks = [];
    let idx = -1;

    function uid(){return Math.random().toString(36).slice(2,9)}
    function load(){try{decks = JSON.parse(localStorage.getItem(KEY)||'[]')}catch{decks=[]}}
    function save(){localStorage.setItem(KEY, JSON.stringify(decks))}
    function parseKeywords(t){return t.split(',').map(s=>s.trim()).filter(Boolean)}
    function fmtTags(arr){return arr.map(k=>`<span class="tag">${k}</span>`).join('')}
    function renderList(){
      const list=document.getElementById('list');
      list.innerHTML='';
      if(decks.length===0){list.innerHTML='<div class="small">항목이 없습니다.</div>';return;}
      decks.forEach((d,i)=>{
        const div=document.createElement('div');
        div.className='item';
        div.innerHTML=`<div style="flex:1"><b>${d.title}</b><div>${fmtTags(d.keywords)}</div></div>
          <button class="btn btn-ghost" data-act="edit" data-i="${i}">수정</button>
          <button class="btn btn-danger" data-act="del" data-i="${i}">삭제</button>`;
        list.appendChild(div);
      });
      renderSelect();
    }
    function renderSelect(){
      const sel=document.getElementById('deckSelect');
      sel.innerHTML=decks.map((d,i)=>`<option value="${i}">${i+1}. ${d.title}</option>`).join('');
    }
    function loadToForm(i){
      const d=decks[i];if(!d)return;
      title.value=d.title;keywords.value=d.keywords.join(', ');refAnswer.value=d.ref||'';
    }

    document.getElementById('saveBtn').onclick=()=>{
      const t=title.value.trim();const ks=parseKeywords(keywords.value);const ref=refAnswer.value.trim();
      if(!t||ks.length===0){alert('제목과 키워드를 입력하세요.');return;}
      const f=decks.findIndex(d=>d.title===t);
      if(f>-1){decks[f].keywords=ks;decks[f].ref=ref||undefined;}
      else{decks.push({id:uid(),title:t,keywords:ks,ref:ref||undefined});}
      save();renderList();
      title.value='';keywords.value='';refAnswer.value='';
    };
    document.getElementById('clearFormBtn').onclick=()=>{title.value='';keywords.value='';refAnswer.value='';};
    document.getElementById('list').onclick=e=>{
      const b=e.target.closest('button');if(!b)return;
      const i=+b.dataset.i;
      if(b.dataset.act==='del'){if(confirm('삭제할까요?')){decks.splice(i,1);save();renderList();}}
      else if(b.dataset.act==='edit'){loadToForm(i);}
    };

    function show(i){
      if(decks.length===0)return;
      idx=(i+decks.length)%decks.length;
      deckSelect.value=idx;
      const d=decks[idx];
      qTitle.textContent=d.title;
      qInfo.textContent=`키워드 ${d.keywords.length}개`;
      answer.value='';result.textContent='';miss.textContent='';
      meterFill.style.width='0%';
    }
    function grade(){
      if(idx<0)return;
      const d=decks[idx];const txt=answer.value.toLowerCase();
      const hits=[],missed=[];
      d.keywords.forEach(k=>{
        const kw=k.toLowerCase();
        if(txt.includes(kw))hits.push(k);else missed.push(k);
      });
      const ratio=hits.length/d.keywords.length;
      meterFill.style.width=(ratio*100)+'%';
      meterFill.style.background=ratio>=0.7?'linear-gradient(90deg,#22c55e,#84cc16)':'linear-gradient(90deg,#ef4444,#f97316)';
      result.textContent=`${(ratio*100).toFixed(0)}% 맞춤 (${hits.length}/${d.keywords.length})`;
      miss.innerHTML=missed.length?'누락: '+fmtTags(missed):'';
    }

    gradeBtn.onclick=grade;
    nextBtn.onclick=()=>show(idx+1);
    prevBtn.onclick=()=>show(idx-1);
    shuffleBtn.onclick=()=>{
      for(let i=decks.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[decks[i],decks[j]]=[decks[j],decks[i]];}
      save();renderList();show(0);
    };
    deckSelect.onchange=e=>show(+e.target.value);

    document.getElementById('exportBtn').onclick=()=>{
      const d=new Date(),z=n=>String(n).padStart(2,'0');
      const name=`recall-decks-${d.getFullYear()}${z(d.getMonth()+1)}${z(d.getDate())}-${z(d.getHours())}${z(d.getMinutes())}${z(d.getSeconds())}.json`;
      const blob=new Blob([JSON.stringify(decks,null,2)],{type:'application/json'});
      const url=URL.createObjectURL(blob);const a=document.createElement('a');
      a.href=url;a.download=name;a.click();setTimeout(()=>URL.revokeObjectURL(url),1500);
    };
    document.getElementById('importFile').onchange=e=>{
      const f=e.target.files?.[0];if(!f)return;
      const rd=new FileReader();
      rd.onload=()=>{
        try{
          const data=JSON.parse(rd.result);
          if(!Array.isArray(data))throw new Error('형식 오류');
          const incoming=data.map(x=>({id:x.id||uid(),title:String(x.title||''),keywords:(x.keywords||[]).map(String),ref:x.ref?String(x.ref):undefined}));
          const merge=document.getElementById('mergeImport')?.checked;
          if(merge){
            const map=new Map(decks.map(d=>[d.title,d]));
            for(const nd of incoming){
              const ex=map.get(nd.title);
              if(ex){
                const set=new Set([...(ex.keywords||[]),...(nd.keywords||[])]);
                ex.keywords=Array.from(set);
                if(!ex.ref&&nd.ref)ex.ref=nd.ref;
              }else decks.push(nd);
            }
          }else decks=incoming;
          save();renderList();show(0);
        }catch(err){alert('가져오기 실패: '+err.message);}
      };
      rd.readAsText(f,'utf-8');
      e.target.value='';
    };

    load();renderList();if(decks.length)show(0);
  </script>
</body>
</html>
