<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>í˜„ì¶œì—°ìŠµ ì›¹ì•± â€“ ë¯¼íŠ¸ ë¼ì´íŠ¸ í…Œë§ˆ(ëª¨ë˜ ë²„íŠ¼)</title>
<style>
  :root{
    /* ë¼ì´íŠ¸ + ë¯¼íŠ¸ í¬ì¸íŠ¸ */
    --bg:#ffffff;
    --panel:#ffffff;
    --line:#e5e7eb;
    --shadow:0 10px 24px rgba(2, 6, 23, .08);

    --text:#0f172a;
    --muted:#64748b;

    --brand:#10b981;         /* ì—ë©”ë„ë“œ ë¯¼íŠ¸ */
    --brand-strong:#059669;
    --good:#16a34a;
    --bad:#ef4444;
    --warn:#f59e0b;

    --chip-bg:#f8fafc;
    --chip-line:#e2e8f0;
    --hint-bg:#f0fdf4;
    --meter-bg:#e8f6f4;
  }

  *{box-sizing:border-box}
  body{
    margin:0;background:var(--bg);color:var(--text);
    font-family:Pretendard,Apple SD Gothic Neo,system-ui,sans-serif;
  }

  .wrap{max-width:1200px;margin:32px auto;padding:20px}
  h1{font-size:26px;margin:0 0 4px;font-weight:800;color:var(--brand-strong);letter-spacing:-0.3px}
  .sub{color:var(--muted);font-size:14px;margin-bottom:22px}

  .grid{display:grid;grid-template-columns:380px 1fr;gap:20px}
  .card{background:var(--panel);border:1px solid var(--line);border-radius:18px;box-shadow:var(--shadow);overflow:hidden}
  .hd{display:flex;align-items:center;justify-content:space-between;padding:14px 18px;border-bottom:1px solid var(--line);background:#fafafa}
  .bd{padding:16px}

  input,textarea,select{
    width:100%;border:1px solid var(--line);border-radius:12px;padding:12px 14px;font-size:14px;
    font-family:inherit;outline:none;background:#fff;color:var(--text);transition:border-color .2s, box-shadow .2s, transform .06s;
  }
  input:focus,textarea:focus,select:focus{
    border-color:#a7f3d0; box-shadow:0 0 0 4px rgba(16,185,129,.18);
  }
  textarea{min-height:90px;resize:vertical}
  .row{display:flex;gap:12px;align-items:center}
  .row>*{flex:1}
  .note{color:var(--muted);font-size:13px}
  .sep{height:1px;background:var(--line);margin:16px 0}
  .list{max-height:420px;overflow:auto;padding-right:6px}
  .item{padding:12px;margin:10px 0;background:#fff;border:1px solid var(--line);border-radius:14px;display:flex;align-items:center;gap:10px}
  .tag{display:inline-block;border:1px solid var(--chip-line);background:var(--chip-bg);color:var(--text);border-radius:999px;padding:6px 10px;margin:4px 6px 0 0;font-size:12px}

  .hint{background:var(--hint-bg);border:1px dashed var(--line);border-radius:12px;padding:12px;margin-top:8px}

  .meter{height:14px;background:var(--meter-bg);border:1px solid var(--line);border-radius:999px;overflow:hidden}
  .fill{height:100%;background:linear-gradient(90deg,#34d399,#10b981);width:0%}

  /* ====== ëª¨ë˜ ë²„íŠ¼ ìŠ¤íƒ€ì¼ (ìš”ì¦˜ ì›¹ ëŠë‚Œ) ====== */
  .btn{
    --btn-bg:#ffffff;
    --btn-border:var(--line);
    --btn-fg:var(--text);
    position:relative; display:inline-flex; align-items:center; justify-content:center;
    gap:8px; padding:10px 14px; border-radius:12px;
    border:1px solid var(--btn-border); background:var(--btn-bg); color:var(--btn-fg);
    font-weight:700; font-size:14px; cursor:pointer; user-select:none;
    transition:transform .08s ease, box-shadow .2s ease, background .2s ease, border-color .2s ease, filter .2s ease;
    box-shadow:0 1px 0 rgba(2,6,23,.03), 0 6px 12px rgba(2,6,23,.04);
  }
  .btn:hover{transform:translateY(-1px); box-shadow:0 6px 16px rgba(2,6,23,.08);}
  .btn:active{transform:translateY(0); box-shadow:0 2px 8px rgba(2,6,23,.06);}
  .btn:focus-visible{outline:none; box-shadow:0 0 0 4px rgba(16,185,129,.22);}

  /* í”„ë¼ì´ë¨¸ë¦¬: ë¯¸ì„¸ ê·¸ë¼ë°ì´ì…˜ + ê´‘íƒ ë ˆì´ì–´ */
  .btn-primary{
    --btn-bg:linear-gradient(180deg,#34d399,#10b981);
    --btn-border:#0ea37e;
    --btn-fg:#fff;
    box-shadow:0 6px 16px rgba(16,185,129,.22);
  }
  .btn-primary::after{
    /* ìƒë‹¨ ì–‡ì€ ê´‘íƒ */
    content:""; position:absolute; inset:0; border-radius:12px; pointer-events:none;
    background:linear-gradient(180deg,rgba(255,255,255,.35),rgba(255,255,255,0));
    mix-blend-mode:soft-light; opacity:.7;
  }
  .btn-primary:hover{filter:brightness(1.02);}
  .btn-primary:active{filter:brightness(.98);}

  /* ê³ ìŠ¤íŠ¸: íˆ¬ëª… ì¹´ë“œí˜• */
  .btn-ghost{
    --btn-bg:#ffffff;
    --btn-border:var(--line);
  }
  .btn-ghost:hover{background:#f8fafc;}

  /* ìœ„í—˜ ë²„íŠ¼ */
  .btn-danger{
    --btn-bg:linear-gradient(180deg,#f87171,#ef4444);
    --btn-border:#dc2626; --btn-fg:#fff;
    box-shadow:0 6px 16px rgba(239,68,68,.18);
  }

  /* ì¹©í˜•(ì‘ì€ ë¼ìš´ë“œ pill) */
  .btn-chip{
    --btn-bg:#ffffff; --btn-border:var(--chip-line);
    border-radius:999px; padding:8px 12px; font-weight:700; font-size:12px;
  }

  /* ì•„ì´ì½˜ í¬ê¸° ê· ì¼í™”ìš© (ì›í•˜ë©´ spanì— class="icon" ì‚¬ìš©) */
  .icon{width:16px; height:16px; display:inline-block}

  .status{margin-top:10px;border-radius:14px;padding:12px;border:1px solid;display:flex;align-items:center;gap:10px;font-weight:700}
  .ok{background:#ecfdf5;border-color:#a7f3d0;color:#065f46}
  .ng{background:#fef2f2;border-color:#fecaca;color:#7f1d1d}
  .warn{background:#fffbeb;border-color:#fde68a;color:#7c2d12}
</style>
</head>
<body>
  <div class="wrap">
    <h1>í˜„ì¶œì—°ìŠµ ì›¹ì•±</h1>
    <div class="sub">ì œëª©Â·í‚¤ì›Œë“œ ê¸°ë°˜ ì„œìˆ í˜• ëŒ€ë¹„ â€” <b style="color:var(--brand)">ë¯¼íŠ¸ ë¼ì´íŠ¸ í…Œë§ˆ</b> + <b style="color:var(--brand)">ëª¨ë˜ ë²„íŠ¼</b></div>

    <div class="grid">
      <!-- ì™¼ìª½: ì„¸íŠ¸ ê´€ë¦¬ -->
      <section class="card">
        <div class="hd">
          <strong>ì„¸íŠ¸ ê´€ë¦¬</strong>
          <div class="row" style="flex:0 0 auto">
            <button class="btn btn-ghost" id="exportBtn">ë‚´ë³´ë‚´ê¸°</button>
            <label class="btn btn-ghost" for="importFile">ê°€ì ¸ì˜¤ê¸°</label>
            <input id="importFile" type="file" accept="application/json" style="display:none" />
          </div>
        </div>
        <div class="bd">
          <div class="note">í‚¤ì›Œë“œëŠ” ì‰¼í‘œ(, )ë¡œ êµ¬ë¶„. ì˜ˆ: ê³µì •ë ¥, ì²˜ë¶„ì„±, ì œì†Œê¸°ê°„</div>
          <div style="height:8px"></div>
          <input id="title" type="text" placeholder="ì œëª© ì…ë ¥" />
          <div style="height:8px"></div>
          <textarea id="keywords" placeholder="í‚¤ì›Œë“œ ì…ë ¥(ì‰¼í‘œë¡œ êµ¬ë¶„)"></textarea>
          <div style="height:8px"></div>
          <textarea id="refAnswer" placeholder="ì°¸ê³  ë‹µì•ˆ(ì„ íƒ)"></textarea>
          <div style="height:12px"></div>
          <div class="row">
            <button class="btn btn-primary" id="saveBtn">ì¶”ê°€/ì €ì¥</button>
            <button class="btn btn-danger" id="clearFormBtn">ì§€ìš°ê¸°</button>
          </div>

          <div class="sep"></div>
          <span class="note">ì„¸íŠ¸ ëª©ë¡</span>
          <div id="list" class="list"></div>
        </div>
      </section>

      <!-- ì˜¤ë¥¸ìª½: ì—°ìŠµ ì˜ì—­ -->
      <section class="card">
        <div class="hd">
          <strong>í˜„ì¶œ ì—°ìŠµ</strong>
          <div class="row" style="flex:0 0 auto">
            <label class="btn btn-chip" style="gap:8px"><input type="checkbox" id="weakOnly"> ë°˜ë³µí•™ìŠµ(â‰¤60%)</label>
            <label class="btn btn-chip" style="gap:8px"><input type="checkbox" id="hintToggle" checked> íŒíŠ¸ í‘œì‹œ</label>
          </div>
        </div>
        <div class="bd">
          <div class="row">
            <select id="deckSelect"></select>
            <button class="btn btn-chip" id="prevBtn">ì´ì „</button>
            <button class="btn btn-chip" id="nextBtn">ë‹¤ìŒ</button>
          </div>

          <div class="hint">
            <b id="qTitle">ì—°ìŠµí•  í•­ëª©ì„ ì„ íƒí•˜ì„¸ìš”.</b>
            <span class="note mini" id="qInfo"></span>
          </div>
          <div id="hintBox" class="hint mini" style="display:none"></div>

          <div style="height:8px"></div>
          <textarea id="answer" placeholder="ê¸°ì–µë‚˜ëŠ” í‚¤ì›Œë“œ ì¤‘ì‹¬ìœ¼ë¡œ ê°„ë‹¨íˆ ì‘ì„±. (Ctrl+Enterë¡œ ì±„ì )"></textarea>

          <div style="height:10px"></div>
          <div class="row" style="align-items:center">
            <button class="btn btn-primary" id="gradeBtn">ì±„ì </button>
            <button class="btn btn-ghost" id="showRefBtn" style="flex:0 0 auto">ì°¸ê³  ë‹µì•ˆ ë³´ê¸°</button>
          </div>

          <div style="height:12px"></div>
          <div class="meter"><div id="meterFill" class="fill"></div></div>

          <div id="statusBox" class="status warn" style="display:none">
            <span id="statusIcon">âš ï¸</span><span id="statusText">ì±„ì  ëŒ€ê¸° ì¤‘â€¦</span>
          </div>

          <div id="miss" class="note mini" style="margin-top:6px"></div>

          <div id="refWrap" style="display:none;margin-top:10px">
            <div class="note mini">ì°¸ê³  ë‹µì•ˆ</div>
            <pre id="refOut" class="note mini" style="white-space:pre-wrap"></pre>
          </div>
        </div>
      </section>
    </div>
  </div>

<script>
/* === ê¸°ëŠ¥ (ES5, ë‹¨ìˆœ/ì•ˆì •) === */
var decks=[], idx=-1;
var SKEY='recallDecks.v1';

function load(){ try{decks=JSON.parse(localStorage.getItem(SKEY)||'[]');}catch(e){decks=[];} }
function save(){ try{localStorage.setItem(SKEY, JSON.stringify(decks));}catch(e){} }

function renderList(){
  var list=document.getElementById('list'); list.innerHTML='';
  for(var i=0;i<decks.length;i++){
    var d=decks[i];
    var div=document.createElement('div');
    div.className='item';
    div.innerHTML='<div style="flex:1"><b>'+escapeHtml(d.title)+'</b>'+
      '<div class="note mini">'+escapeHtml(d.keywords.join(", "))+'</div></div>'+
      '<button class="btn btn-chip" onclick="show('+i+')">ì—°ìŠµ</button>';
    list.appendChild(div);
  }
  var sel=document.getElementById('deckSelect');
  sel.innerHTML = decks.map(function(d,i){return '<option value="'+i+'">'+(i+1)+'. '+escapeHtml(d.title)+'</option>';}).join('');
}

function show(i){
  if(decks.length===0) return;
  idx=(i+decks.length)%decks.length;
  var d=decks[idx];
  document.getElementById('deckSelect').value=String(idx);
  document.getElementById('qTitle').textContent=d.title;
  document.getElementById('qInfo').textContent=' Â· í‚¤ì›Œë“œ '+d.keywords.length+'ê°œ';
  document.getElementById('answer').value='';
  document.getElementById('meterFill').style.width='0%';
  document.getElementById('statusBox').style.display='none';
  document.getElementById('miss').innerHTML='';
  var hintOn=document.getElementById('hintToggle').checked;
  var box=document.getElementById('hintBox');
  if(hintOn && d.ref){ var t=String(d.ref); box.style.display='block'; box.textContent = t.length>150?t.slice(0,150)+'â€¦':t; }
  else { box.style.display='none'; box.textContent=''; }
  document.getElementById('refWrap').style.display='none';
  document.getElementById('refOut').textContent='';
}

function grade(){
  if(idx<0) return;
  var d=decks[idx];
  var txt=String(document.getElementById('answer').value||'').toLowerCase();
  var hits=[], missed=[];
  for(var i=0;i<d.keywords.length;i++){
    var w=String(d.keywords[i]||''); var lw=w.toLowerCase();
    if(txt.indexOf(lw)>-1) hits.push(w); else missed.push(w);
  }
  var ratio = d.keywords.length ? (hits.length/d.keywords.length) : 0;
  document.getElementById('meterFill').style.width=Math.round(ratio*100)+'%';

  var box=document.getElementById('statusBox');
  var icon=document.getElementById('statusIcon');
  var text=document.getElementById('statusText');

  if(ratio>=0.7){ box.className='status ok'; icon.textContent='âœ…'; text.textContent='ì •ë‹µ '+Math.round(ratio*100)+'%'; }
  else if(ratio>0){ box.className='status warn'; icon.textContent='ğŸŸ¡'; text.textContent='ë¶€ë¶„ì •ë‹µ '+Math.round(ratio*100)+'%'; }
  else{ box.className='status ng'; icon.textContent='âŒ'; text.textContent='ì˜¤ë‹µ 0%'; }
  box.style.display='flex';

  document.getElementById('miss').innerHTML = missed.length ? ('ëˆ„ë½: '+missed.map(escapeHtml).join(', ')) : '<span class="muted">ëˆ„ë½ ì—†ìŒ</span>';
}

function escapeHtml(s){ return String(s).replace(/[&<>"']/g,function(c){return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c];}); }

document.addEventListener('DOMContentLoaded',function(){
  load(); renderList(); if(decks.length) show(0);

  document.getElementById('saveBtn').onclick=function(){
    var t=document.getElementById('title').value.trim();
    var ks=String(document.getElementById('keywords').value).split(',').map(function(v){return v.trim();}).filter(function(x){return !!x;});
    var r=document.getElementById('refAnswer').value.trim();
    if(!t||!ks.length) return alert('ì œëª©/í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
    var ex=-1; for(var i=0;i<decks.length;i++){ if(decks[i].title===t){ ex=i; break; } }
    if(ex>-1){ decks[ex].keywords=ks; decks[ex].ref=r||undefined; }
    else { decks.push({title:t,keywords:ks,ref:r||undefined}); }
    save(); renderList(); document.getElementById('title').value=''; document.getElementById('keywords').value=''; document.getElementById('refAnswer').value='';
    if(decks.length===1) show(0);
  };

  document.getElementById('clearFormBtn').onclick=function(){
    document.getElementById('title').value=''; document.getElementById('keywords').value=''; document.getElementById('refAnswer').value='';
  };

  document.getElementById('deckSelect').onchange=function(e){ show(+e.target.value); };
  document.getElementById('prevBtn').onclick=function(){ show(idx-1); };
  document.getElementById('nextBtn').onclick=function(){ show(idx+1); };
  document.getElementById('gradeBtn').onclick=grade;

  document.getElementById('showRefBtn').onclick=function(){
    if(idx<0) return; var d=decks[idx]; if(!d.ref) return alert('ì°¸ê³  ë‹µì•ˆì´ ì—†ìŠµë‹ˆë‹¤.');
    document.getElementById('refWrap').style.display='block';
    document.getElementById('refOut').textContent = d.ref;
  };

  document.getElementById('hintToggle').onchange=function(){
    if(idx<0) return; var d=decks[idx]; var box=document.getElementById('hintBox');
    if(this.checked && d.ref){ var t=String(d.ref); box.style.display='block'; box.textContent=t.length>150?t.slice(0,150)+'â€¦':t; }
    else{ box.style.display='none'; box.textContent=''; }
  };

  document.getElementById('exportBtn').onclick=function(){
    var blob=new Blob([JSON.stringify(decks,null,2)],{type:'application/json'});
    var a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='recall-'+Date.now()+'.json'; a.click();
    setTimeout(function(){URL.revokeObjectURL(a.href)},1200);
  };

  document.getElementById('importFile').onchange=function(e){
    var f=e.target.files && e.target.files[0]; if(!f) return;
    var r=new FileReader();
    r.onload=function(){
      try{ decks=JSON.parse(String(r.result)); save(); renderList(); if(decks.length) show(0); }
      catch(err){ alert('ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨'); }
    };
    r.readAsText(f,'utf-8'); e.target.value='';
  };

  // Ctrl/Cmd + Enter ì±„ì 
  window.addEventListener('keydown', function(ev){
    var enter = (ev.key==='Enter' || ev.keyCode===13);
    if((ev.ctrlKey||ev.metaKey) && enter){ grade(); ev.preventDefault(); }
  });
});
</script>
</body>
</html>
